pwm在嵌入式系统中扮演者非常重要的角色，它可以控制显示屏和led的亮度、可以控制电机的转速和舵机的角度，通过pwm将数字的电压输出信号转化成了模拟电压的输出，通过控制占空比就可以调节输出的平均电压。

pwm输出是基于定时器的一个功能，使用它需要进行下面的配置（以定时器1为例，定时器0没有成功）：

1、时钟使能；
2、定时器配置；
3、gpio配置；
4、通道配置；
5、打开定时器；
6、更新比较值，改变pwm输出。

首先我们要打开外设的时钟，包括GPIO的时钟和定时器的时钟。gpioa在APB2使能寄存器中配置，定时器1在APB1 使能寄存器 中。这些在前面的文章中已经介绍给，这里就不细说了。
代码如下：


定时器的配置比较简单，设置一下预分频，设置计数方向、对齐模式、自动重载值就可以了。自动重载值决定了pwm的周期。

定时器108分频后是1Mhz，所以2000的重载值周期为2ms。

我这里使用定时器1的通道1，对应的GPIO是A1。设置A1为AFIO 推挽输出。

pwm是输出，所以要将通道配置为输出模式，寄存器是通道控制寄存器 0 ，bit[9:8]为00通道1是输出，输出比较模式配置为pwm0，bit[14:12]设置为110。

设置通道的极性并使能通道，寄存器是通道控制寄存器 2 ，bit[5:4]这里设置为11，通道低电平有效。

比较寄存器在输出模式下存放了即将于计数器进行比较的值，它决定了输出pwm的占空比。主程序中就是改变它的值来调整pwm的输出。
代码如下：


上面都设置好后打开定时器就可以了。

在主程序中设置比较寄存器为500得到波形如下所示：

设置比较寄存器为1500得到波形如下：
